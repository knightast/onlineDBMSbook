# 文档的存储

文档数据库的数据存取功能看似简单。但要高效可靠地实现这些功能却并不简单，必须依靠精巧的技术手段。为了掌握好数据库的使用方法，读者需要了解这些技术手段。
接下来的几节内容将介绍文档数据库的基本工作机理和最重要的技术手段。本节首先介绍数据是如何被存储在系统中的，以及数据存取功能是如何实现的。

## 计算机的数据存储体系

计算机的数据存储体系是一个金字塔结构。下图展示了传统计算机的存储层次结构。最上层CPU里面的寄存器，是CPU中的计算单元直接获取数据的地方。接下来是缓存，用于加速CPU对内存的访问。再下面依此为内存（DRAM）、磁盘（Disk）和离线存储（通常为磁带）。在这个存储层次结构有一个显著特点，即越上层的设备存取速度越快，但单位容量的价格越贵。相应的，越下面的设备存取速度约慢，但单位容量的价格约便宜。

![storage_hierarchy](https://i.pinimg.com/originals/55/71/33/55713334e2109df8fdf635edf511ad23.png)

以其中的内存和磁盘为例，内存的访问延时为100ns（ns为纳秒），而磁盘的访问延时为10ms（ms为毫秒），二者相差近10万倍。但内存比磁盘贵多了，价格差不多是磁盘的200倍。当我们需要保存数据时，我们希望使用磁盘，因为用磁盘保存数据的成本低。当我们需要访问数据时，我们又希望数据存放在内存中，因为这样的访问效率更高。为了结合二者的优点，我们可以将它们组合起来，形成一个双层结构。这样，数据可以放在磁盘中保存，而经常被访问的热数据可以暂存在内存中，以提高访问效率。由此可见，上图中呈现的金字塔结构是一种既能兼顾存储成本和访问效率的合理结构。随着硬件科技的发展，新的存储硬件不断涌现出来，比如最近几年已经相当普及的固态硬盘（Solid State Drive），以及刚问市的非易失内存（Non-volatile Memory）。但无论存储硬件如何改变，这种金字塔型的存储体系却注定不会改变，因为昂贵但速度快的硬件和廉价但速度慢的硬件合起来使用是最高效的。我们在构建数据库系统时，常常需要考虑到这种层次存储结构的特性，尽力做到物尽其用。这个理念将在本书设计的很多技术环节中都会有所体现。

